generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model User {
  id                  String               @id @default(cuid())
  name                String?
  email               String               @unique
  emailVerified       DateTime?
  image               String?
  password            String?
  role                UserRole             @default(USER)
  isPremium           Boolean              @default(false)
  stripeCustomerId    String?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  accounts            Account[]
  sessions            Session[]
  artistProfile       ArtistProfile?
  playEvents          PlayEvent[]
  playlistSubmissions PlaylistSubmission[] @relation("PlaylistSubmissions")
  reviewedSubmissions PlaylistSubmission[] @relation("PlaylistSubmissionReviewedBy")
  addedPlaylistTracks PlaylistTrack[]      @relation("PlaylistTrackAddedBy")
  createdPlaylists    Playlist[]           @relation("PlaylistCreatedBy")
  smartLinks          SmartLink[]
  tracks              Track[]
  uploadJobs          UploadJob[]

  @@map("users")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model ArtistProfile {
  id             String   @id @default(cuid())
  userId         String   @unique
  artistName     String   @unique
  bio            String?
  profileImage   String?
  coverImage     String?
  location       String?
  website        String?
  genre          String?
  slug           String?  @unique
  socialLinks    Json?
  streamingLinks Json?
  isPublic       Boolean  @default(true)
  isVerified     Boolean  @default(false)
  isActive       Boolean  @default(true)
  totalPlays     Int      @default(0)
  totalLikes     Int      @default(0)
  totalFollowers Int      @default(0)
  profileViews   Int      @default(0)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  tracks         Track[]

  @@map("artist_profiles")
}

model Track {
  id                  String               @id @default(cuid())
  title               String
  coverImageUrl       String?
  genre               String?
  album               String?
  description         String?
  duration            Int?
  playCount           Int                  @default(0)
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  filePath            String
  albumArtwork        String?
  artist              String?
  artistProfileId     String
  bitrate             Int?
  bpm                 Int?
  channels            Int?
  composer            String?
  copyrightInfo       String?
  distributionRights  String?
  downloadCount       Int                  @default(0)
  fileSize            Int?
  isDownloadable      Boolean              @default(false)
  isExplicit          Boolean              @default(false)
  isPublic            Boolean              @default(true)
  isrc                String?
  licenseType         String?
  likeCount           Int                  @default(0)
  lyrics              String?
  releaseDate         DateTime?
  sampleRate          Int?
  shareCount          Int                  @default(0)
  uniqueUrl           String               @unique
  userId              String
  watermarkId         String?
  year                Int?
  playEvents          PlayEvent[]
  playlistSubmissions PlaylistSubmission[]
  playlistTracks      PlaylistTrack[]
  smartLinks          SmartLink[]
  artistProfile       ArtistProfile        @relation(fields: [artistProfileId], references: [id], onDelete: Cascade)
  user                User                 @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("tracks")
}

model PlayEvent {
  id        String   @id @default(cuid())
  trackId   String
  userId    String?
  timestamp DateTime @default(now())
  ipAddress String?
  userAgent String?
  track     Track    @relation(fields: [trackId], references: [id], onDelete: Cascade)
  user      User?    @relation(fields: [userId], references: [id])

  @@map("play_events")
}

model SmartLink {
  id            String         @id @default(cuid())
  trackId       String
  userId        String
  slug          String         @unique
  clickCount    Int            @default(0)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  platformLinks PlatformLink[]
  track         Track          @relation(fields: [trackId], references: [id], onDelete: Cascade)
  user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("smart_links")
}

model PlatformLink {
  id          String    @id @default(cuid())
  smartLinkId String
  platform    Platform
  url         String
  clickCount  Int       @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  smartLink   SmartLink @relation(fields: [smartLinkId], references: [id], onDelete: Cascade)

  @@map("platform_links")
}

model UploadJob {
  id        String       @id @default(cuid())
  userId    String
  key       String       @unique
  status    UploadStatus @default(PENDING_UPLOAD)
  fileName  String
  fileType  String
  fileSize  Int
  uploadUrl String?
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  user      User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("upload_jobs")
}

model Playlist {
  id                      String               @id @default(cuid())
  name                    String
  description             String?
  type                    PlaylistType
  coverImage              String
  maxTracks               Int
  currentTracks           Int                  @default(0)
  status                  PlaylistStatus       @default(INACTIVE)
  submissionStatus        SubmissionStatus     @default(CLOSED)
  maxSubmissionsPerArtist Int                  @default(1)
  province                String?
  createdBy               String
  createdAt               DateTime             @default(now())
  updatedAt               DateTime             @updatedAt
  order                   Int                  @default(0)
  analytics               PlaylistAnalytics[]
  submissions             PlaylistSubmission[]
  tracks                  PlaylistTrack[]
  createdByUser           User                 @relation("PlaylistCreatedBy", fields: [createdBy], references: [id], onDelete: Cascade)

  @@map("playlists")
}

model PlaylistSubmission {
  id             String                @id @default(cuid())
  playlistId     String
  trackId        String
  artistId       String
  status         TrackSubmissionStatus @default(PENDING)
  submittedAt    DateTime              @default(now())
  reviewedAt     DateTime?
  reviewedBy     String?
  adminComment   String?
  artistComment  String?
  artist         User                  @relation("PlaylistSubmissions", fields: [artistId], references: [id], onDelete: Cascade)
  playlist       Playlist              @relation(fields: [playlistId], references: [id], onDelete: Cascade)
  reviewedByUser User?                 @relation("PlaylistSubmissionReviewedBy", fields: [reviewedBy], references: [id])
  track          Track                 @relation(fields: [trackId], references: [id], onDelete: Cascade)

  @@map("playlist_submissions")
}

model PlaylistTrack {
  id           String   @id @default(cuid())
  playlistId   String
  trackId      String
  order        Int
  addedAt      DateTime @default(now())
  addedBy      String
  submissionId String?
  addedByUser  User     @relation("PlaylistTrackAddedBy", fields: [addedBy], references: [id], onDelete: Cascade)
  playlist     Playlist @relation(fields: [playlistId], references: [id], onDelete: Cascade)
  track        Track    @relation(fields: [trackId], references: [id], onDelete: Cascade)

  @@unique([playlistId, trackId])
  @@map("playlist_tracks")
}

model PlaylistAnalytics {
  id              String   @id @default(cuid())
  playlistId      String
  date            DateTime @default(now())
  views           Int      @default(0)
  plays           Int      @default(0)
  likes           Int      @default(0)
  shares          Int      @default(0)
  uniqueListeners Int      @default(0)
  playlist        Playlist @relation(fields: [playlistId], references: [id], onDelete: Cascade)

  @@unique([playlistId, date])
  @@map("playlist_analytics")
}

enum UserRole {
  USER
  ARTIST
  ADMIN
}

enum Platform {
  SPOTIFY
  APPLE_MUSIC
  YOUTUBE
  SOUNDCLOUD
}

enum UploadStatus {
  PENDING_UPLOAD
  UPLOADED
  PROCESSING
  COMPLETED
  FAILED
}

enum PlaylistType {
  GENRE
  FEATURED
  TOP_TEN
  PROVINCE
}

enum PlaylistStatus {
  ACTIVE
  INACTIVE
}

enum SubmissionStatus {
  OPEN
  CLOSED
}

enum TrackSubmissionStatus {
  PENDING
  APPROVED
  REJECTED
  SHORTLISTED
}
